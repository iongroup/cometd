!function(e,t){void 0===e&&void 0!==window&&(e=window),"function"==typeof define&&define.amd?define("cometd",[],function(){return e.cometd=t()}):"object"==typeof module&&module.exports?module.exports=t():e.cometd=t()}(this,function(){var e,t;return t=()=>{var we="undefined"!=typeof window?window:{};function ke(){let n=0;const i={};this.register=e=>{var t=++n;return i[t]=e,t},this.unregister=e=>{var t=i[e];return delete i[e],t},this.setTimeout=(e,t)=>window.setTimeout(e,t),this.clearTimeout=e=>{window.clearTimeout(e)}}const _e={isString:e=>null!=e&&("string"==typeof e||e instanceof String),isArray:function(e){return null!=e&&e instanceof Array},inArray:function(e,t){for(var n=0;n<t.length;++n)if(e===t[n])return n;return-1},setTimeout:function(t,n,e){return we.setTimeout(function(){try{t._debug("Invoking timed function",n),n()}catch(e){t._debug("Exception invoking timed function",n,e)}},e)},clearTimeout:function(e){we.clearTimeout(e)}};function Se(){let a=[],c={};this.getTransportTypes=()=>a.slice(0),this.findTransportTypes=(t,n,i)=>{var s=[];for(let e=0;e<a.length;++e){var r=a[e];!0===c[r].accept(t,n,i)&&s.push(r)}return s},this.negotiateTransport=(t,n,i,s)=>{for(let e=0;e<a.length;++e){var r=a[e];for(let e=0;e<t.length;++e)if(r===t[e]){var o=c[r];if(!0===o.accept(n,i,s))return o}}return null},this.add=(t,e,n)=>{let i=!1;for(let e=0;e<a.length;++e)if(a[e]===t){i=!0;break}return i||("number"!=typeof n?a.push(t):a.splice(n,0,t),c[t]=e),!i},this.find=t=>{for(let e=0;e<a.length;++e)if(a[e]===t)return c[t];return null},this.remove=t=>{for(let e=0;e<a.length;++e){var n;if(a[e]===t)return a.splice(e,1),n=c[t],delete c[t],n}return null},this.clear=()=>{a=[],c={}},this.reset=t=>{for(let e=0;e<a.length;++e)c[a[e]].reset(t)}}function y(){let n,r,t;this.registered=(e,t)=>{n=e,r=t},this.unregistered=()=>{n=null,r=null},this._notifyTransportTimeout=function(t){var n=r._getTransportListeners("timeout");if(n)for(let e=0;e<n.length;++e){var i=n[e];try{var s=i.call(this,t);if("number"==typeof s&&0<s)return s}catch(e){this._info("Exception during execution of transport listener",i,e)}}return 0},this._debug=function(){r._debug.apply(r,arguments)},this._logError=function(){r._logError.apply(r,arguments)},this._mixin=function(){return r._mixin.apply(r,arguments)},this.getConfiguration=()=>r.getConfiguration(),this.getAdvice=()=>r.getAdvice(),this.setTimeout=(e,t)=>r.setTimeout(e,t),this.clearTimeout=e=>{r.clearTimeout(e)},this.convertToJSON=function(t){var n=this.getConfiguration().maxSendBayeuxMessageSize;let i="[";for(let e=0;e<t.length;++e){0<e&&(i+=",");var s=t[e],s=JSON.stringify(s);if(s.length>n)throw"maxSendBayeuxMessageSize "+n+" exceeded";i+=s}return i+="]"};this.convertToMessages=function(t){if(_e.isString(t))try{return JSON.parse(t)}catch(e){throw this._logError("Could not convert to JSON the following string",{msg:(n=t).length<512?n:n.substr(0,256)+"[...]"+n.substr(n.length-256),length:t.length}),e}var n;if(Array.isArray(t))return t;if(null==t)return[];if(t instanceof Object)return[t];throw"Conversion Error "+t+", typeof "+typeof t},this.accept=(e,t,n)=>{throw"Abstract"},this.getType=()=>n,this.getURL=()=>t,this.setURL=e=>{t=e},this.send=(e,t)=>{throw"Abstract"},this.reset=function(e){this._debug("Transport",n,"reset",e?"initial":"retry")},this.abort=function(){this._debug("Transport",n,"aborted")},this.toString=function(){return this.getType()}}function n(){const n=new y;var e=y.derive(n);let i=0,s=null,r=[],o=[];function a(e,t,n){const i=this._notifyTransportTimeout(e.messages);var s,r,o;0<i?(this._debug("Transport",this.getType(),"extended waiting for message replies of request",t.id,":",i,"ms"),t.timeout=this.setTimeout(()=>{a.call(this,e,t,n+i)},i)):(t.expired=!0,s="Transport "+this.getType()+" expired waiting for message replies of request "+t.id+": "+n+" ms",o=t.xhr,(r={reason:s}).httpCode=this.xhrStatus(o),this.abortXHR(o),this._debug(s),this.complete(t,!1,t.metaConnect),e.onFailure(o,e.messages,r))}function c(t,n){if(this.transportSend(t,n)&&(n.expired=!1,!t.sync)){let e=this.getConfiguration().maxNetworkDelay;!0===n.metaConnect&&(e+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"started waiting for message replies of request",n.id,":",e,"ms"),n.timeout=this.setTimeout(()=>{a.call(this,t,n,e)},e)}}function l(e){var t=++i,n={id:t,metaConnect:!1,envelope:e};r.length<this.getConfiguration().maxConnections-1?(r.push(n),c.call(this,e,n)):(this._debug("Transport",this.getType(),"queueing request",t,"envelope",e),o.push([e,n]))}function u(e,t){var n=r.indexOf(e);if(0<=n&&r.splice(n,1),0<o.length){n=o.shift();const i=n[0],s=n[1];this._debug("Transport dequeued request",s.id),t?(this.getConfiguration().autoBatch&&function(e){for(;0<o.length;){var t=o[0],n=t[0],t=t[1];if(n.url!==e.url||n.sync!==e.sync)break;o.shift(),e.messages=e.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",t.id)}}.call(this,i),l.call(this,i),this._debug("Transport completed request",e.id,i)):this.setTimeout(()=>{this.complete(s,!1,s.metaConnect);var e={reason:"Previous request failed"},t=s.xhr;e.httpCode=this.xhrStatus(t),i.onFailure(t,i.messages,e)},0)}}return e.complete=function(e,t,n){n?function(e){if(e=e.id,this._debug("Transport",this.getType(),"/meta/connect complete, request",e),null!==s&&s.id!==e)throw"/meta/connect request mismatch, completing request "+e;s=null}.call(this,e):u.call(this,e,t)},e.transportSend=(e,t)=>{throw"Abstract"},e.transportSuccess=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this._debug("Transport",this.getType(),"cancelled waiting for message replies"),this.complete(t,!0,t.metaConnect),n&&0<n.length?e.onSuccess(n):e.onFailure(t.xhr,e.messages,{httpCode:204}))},e.transportFailure=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this._debug("Transport",this.getType(),"cancelled waiting for failed message replies"),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,n))},e.send=function(e,t){(t?function(e){if(null!==s)throw"Concurrent /meta/connect requests not allowed, request id="+s.id+" not yet completed";var t=++i,t=(this._debug("Transport",this.getType(),"/meta/connect send, request",t,"envelope",e),{id:t,metaConnect:!0,envelope:e});c.call(this,e,t),s=t}:l).call(this,e)},e.abort=function(){n.abort();for(let e=0;e<r.length;++e){var t=r[e];t&&(this._debug("Aborting request",t),this.abortXHR(t.xhr)||this.transportFailure(t.envelope,t,{reason:"abort"}))}var e=s;e&&(this._debug("Aborting /meta/connect request",e),this.abortXHR(e.xhr)||this.transportFailure(e.envelope,e,{reason:"abort"})),this.reset(!0)},e.reset=e=>{n.reset(e),s=null,r=[],o=[]},e.abortXHR=function(e){if(e)try{var t=e.readyState;return e.abort(),t!==we.XMLHttpRequest.UNSENT}catch(e){this._debug(e)}return!1},e.xhrStatus=function(e){if(e)try{return e.status}catch(e){this._debug(e)}return-1},e}function Ce(){const t=new n,r=y.derive(t);let o=!0;return r.accept=(e,t,n)=>o||!t,r.newXMLHttpRequest=()=>new we.XMLHttpRequest,r.xhrSend=e=>{const t=r.newXMLHttpRequest();var n=t;try{n.context=r.context}catch(e){r._debug("Could not copy transport context into XHR",e)}t.withCredentials=!0,t.open("POST",e.url,!0!==e.sync);var i=e.headers;if(i)for(var s in i)i.hasOwnProperty(s)&&t.setRequestHeader(s,i[s]);return t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.onload=()=>{200===t.status?e.onSuccess(t.responseText):e.onError(t.statusText)},t.onabort=t.onerror=()=>{e.onError(t.statusText)},t.send(e.body),t},r.transportSend=function(s,r){this._debug("Transport",this.getType(),"sending request",r.id,"envelope",s);try{let i=!0;return r.xhr=this.xhrSend({transport:this,url:s.url,sync:s.sync,headers:this.getConfiguration().requestHeaders,body:this.convertToJSON(s.messages),onSuccess:t=>{this._debug("Transport",this.getType(),"received response",t);let n=!1;try{var e=this.convertToMessages(t);0===e.length?(o=!1,this.transportFailure(s,r,{httpCode:204})):(n=!0,this.transportSuccess(s,r,e))}catch(e){this._debug(e),n||(o=!1,(t={exception:e}).httpCode=this.xhrStatus(r.xhr),this.transportFailure(s,r,t))}},onError:(e,t)=>{this._debug("Transport",this.getType(),"received error",e,t),o=!1;const n={reason:e,exception:t};n.httpCode=this.xhrStatus(r.xhr),i?this.setTimeout(()=>{this.transportFailure(s,r,n)},0):this.transportFailure(s,r,n)}}),!(i=!1)}catch(e){return this._debug("Transport",this.getType(),"exception:",e),o=!1,this.setTimeout(()=>{this.transportFailure(s,r,{exception:e})},0),!1}},r.reset=e=>{t.reset(e),o=!0},r}function Re(){var e=new n,e=y.derive(e);let r=0;function u(e,t,n){return()=>{this.transportFailure(e,t,"error",n)}}return e.accept=(e,t,n)=>!0,e.jsonpSend=t=>{const n=document.getElementsByTagName("head")[0],i=document.createElement("script"),s="_cometd_jsonp_"+r++;we[s]=e=>{n.removeChild(i),delete we[s],t.onSuccess(e)};let e=t.url;e=(e=(e+=e.indexOf("?")<0?"?":"&")+"jsonp="+s)+"&message="+encodeURIComponent(t.body),i.src=e,i.async=!0!==t.sync,i.type="application/javascript",i.onerror=e=>{t.onError("jsonp "+e.type)},n.appendChild(i)},e.transportSend=function(n,s){let e=0,t=n.messages.length;for(var i=[];0<t;){var r=JSON.stringify(n.messages.slice(e,e+t)),r=n.url.length+encodeURI(r).length,o=this.getConfiguration().maxURILength;if(o<r){if(1===t)return r="Bayeux message too big ("+r+" bytes, max is "+o+") for transport "+this.getType(),void this.setTimeout(u.call(this,n,s,r),0);--t}else i.push(t),e+=t,t=n.messages.length-e}let a=n;if(1<i.length){let t=i[0];this._debug("Transport",this.getType(),"split",n.messages.length,"messages into",i.join(" + ")),(a=this._mixin(!1,{},n)).messages=n.messages.slice(0,t),a.onSuccess=n.onSuccess,a.onFailure=n.onFailure;for(let e=1;e<i.length;++e){var c=this._mixin(!1,{},n),l=t;t+=i[e],c.messages=n.messages.slice(l,t),c.onSuccess=n.onSuccess,c.onFailure=n.onFailure,this.send(c,s.metaConnect)}}this._debug("Transport",this.getType(),"sending request",s.id,"envelope",a);try{let i=!0;return this.jsonpSend({transport:this,url:a.url,sync:a.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(a.messages),onSuccess:e=>{let t=!1;try{var n=this.convertToMessages(e);0===n.length?this.transportFailure(a,s,{httpCode:204}):(t=!0,this.transportSuccess(a,s,n))}catch(e){this._debug(e),t||this.transportFailure(a,s,{exception:e})}},onError:(e,t)=>{const n={reason:e,exception:t};i?this.setTimeout(()=>{this.transportFailure(a,s,n)},0):this.transportFailure(a,s,n)}}),!(i=!1)}catch(e){return this.setTimeout(()=>{this.transportFailure(a,s,{exception:e})},0),!1}},e}function Ee(){const n=new y,c=y.derive(n);let u,l=!0,h=!(c.webSocketConnected=!1),d=null,g=null,f=!1,p=null;function m(e,t){e&&(this.webSocketClose(e,t.code,t.reason),this.onClose(e,t))}function b(e){return e===g||e===d}function i(e,t,n){var i=[];for(let e=0;e<t.messages.length;++e){var s=t.messages[e];s.id&&i.push(s.id)}e.envelopes[i.join(",")]=[t,n],this._debug("Transport",this.getType(),"stored envelope, envelopes",e.envelopes)}function v(e,t){let n=!1;var i=e.envelopes;for(let e=0;e<t.length;++e){var s,r=t[e];for(s in i)if(i.hasOwnProperty(s)){var o=s.split(","),a=o.indexOf(r);if(0<=a){n=!0,o.splice(a,1);var a=i[s][0],c=i[s][1];delete i[s],0<o.length&&(i[o.join(",")]=[a,c]);break}}}n&&this._debug("Transport",this.getType(),"removed envelope, envelopes",i)}function r(n,i,e){let t;try{t=this.convertToJSON(i.messages)}catch(e){this._debug("Transport",this.getType(),"exception:",e);var s=[];for(let e=0;e<i.messages.length;++e){var r=i.messages[e];s.push(r.id)}return v.call(this,n,s),void this.setTimeout(()=>{this._notifyFailure(i.onFailure,n,i.messages,{exception:e})},0)}n.webSocket.send(t),this._debug("Transport",this.getType(),"sent",i,"/meta/connect =",e),this.onStat({tx:t.length});let o=this.getConfiguration().maxNetworkDelay;e&&(o+=this.getAdvice().timeout,f=!0);for(var a=this,c=[],l=0;l<i.messages.length;++l)!function(){var e,t=i.messages[l];t.id&&(c.push(t.id),e={clear:function(){e.timeout&&a.clearTimeout(e.timeout),e.timeout=null},rearm:function(){e.clear(),e.timeout=a.setTimeout(function(){u._debug("Transport",a.getType(),"timing out message",t.id,"after",o,"on",n),m.call(a,n,{code:1e3,reason:"Message Timeout"})},o)}},(n.timeouts[t.id]=e).rearm())}();this._debug("Transport",this.getType(),"started waiting for message replies",o,"ms, messageIds:",c,", timeouts:",n.timeouts)}function s(t,e,n){try{null===t?(t=g||{envelopes:{},timeouts:{}},i.call(this,t,e,n),function(t){if(!g){const n=u.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",n);try{var e=u.getConfiguration().protocol;t.webSocket=e?new we.WebSocket(n,e):new we.WebSocket(n),g=t}catch(e){throw l=!1,this._debug("Exception while creating WebSocket object",e),e}h=!1!==u.getConfiguration().stickyReconnect;const i=u.getConfiguration().connectTimeout;0<i&&(t.connectTimer=this.setTimeout(()=>{u._debug("Transport",this.getType(),"timed out while connecting to URL",n,":",i,"ms"),m.call(this,t,{code:1e3,reason:"Connect Timeout"})},i));const s=e=>{e=e||{code:1e3},u._debug("WebSocket onclose",t,e,"connecting",g,"current",d),t.connectTimer&&this.clearTimeout(t.connectTimer),this.onClose(t,e)};t.webSocket.onopen=()=>{u._debug("WebSocket onopen",t),t.connectTimer&&this.clearTimeout(t.connectTimer),b(t)?(g=null,d=t,c.webSocketConnected=!0,this.onOpen(t)):(u._warn("Closing extra WebSocket connection",this,"active connection",d),m.call(this,t,{code:1e3,reason:"Extra Connection"}))},t.webSocket.onclose=s,t.webSocket.onerror=()=>{s({code:1e3,reason:"Error"})},t.webSocket.onmessage=e=>{u._debug("WebSocket onmessage",e,t),this.onMessage(t,e)},this._debug("Transport",this.getType(),"configured callbacks on",t)}}.call(this,t)):(i.call(this,t,e,n),r.call(this,t,e,n))}catch(e){this.setTimeout(()=>{m.call(this,t,{code:1e3,reason:"Exception",exception:e})},0)}}return c.reset=e=>{n.reset(e),l=!0,e&&(c.webSocketConnected=!1),h=!0,e&&(d=null),g=null,f=!1},c._notifySuccess=function(e,t){e.call(this,t)},c._notifyFailure=function(e,t,n,i){e.call(this,t,n,i)},c.onOpen=function(e){var t,n,i,s=e.envelopes;for(t in this._debug("Transport",this.getType(),"opened",e,"pending messages",s),s)s.hasOwnProperty(t)&&(n=(i=s[t])[0],i=i[1],p=n.onSuccess,r.call(this,e,n,i))},c.onMessage=function(e,t){if(this._debug("Transport",this.getType(),"received websocket message",t,e),this.onStat({rx:t.data&&t.data.length||0}),this.getConfiguration().rearmNetworkDelayAfterMessage){var n=(new Date).getTime();if(!e._lastRearm||1e3<n-e._lastRearm)for(var i in e._lastRearm=n,e.timeouts)e.timeouts.hasOwnProperty(i)&&e.timeouts[i].rearm()}for(var s=!1,r=this.convertToMessages(t.data),o=[],a=0;a<r.length;++a){var c,l=r[a];(/^\/meta\//.test(l.channel)||void 0===l.data)&&l.id&&(o.push(l.id),c=e.timeouts[l.id])&&(c.clear(),delete e.timeouts[l.id],this._debug("Transport",this.getType(),"removed timeout for message",l.id,", timeouts",e.timeouts)),"/meta/connect"===l.channel&&(f=!1),"/meta/disconnect"!==l.channel||f||(s=!0)}v.call(this,e,o),this._notifySuccess(p,r),s&&this.webSocketClose(e,1e3,"Disconnect")},c.onClose=function(e,t){this._debug("Transport",this.getType(),"closed",e,t),b(e)&&(l=h&&c.webSocketConnected,g=null,d=null);var n,i=e.timeouts;for(n in e.timeouts={},i)i.hasOwnProperty(n)&&i[n].clear();var s,r,o,a=e.envelopes;for(s in e.envelopes={},a)a.hasOwnProperty(s)&&(r=a[s][0],a[s][1]&&(f=!1),o={websocketCode:t.code,reason:t.reason},t.exception&&(o.exception=t.exception),this._notifyFailure(r.onFailure,e,r.messages,o))},c.registered=(e,t)=>{n.registered(e,t),u=t},c.accept=function(e,t,n){return this._debug("Transport",this.getType(),"accept, supported:",l),l&&!!we.WebSocket&&!1!==u.websocketEnabled},c.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"/meta/connect =",t),s.call(this,d,e,t)},c.webSocketClose=function(e,t,n){try{e.webSocket&&e.webSocket.close(t,n)}catch(e){this._debug(e)}},c.abort=function(){n.abort(),m.call(this,d,{code:1e3,reason:"Abort"}),this.reset(!0)},c.onStat=function(e){},c}y.derive=e=>{function t(){}return t.prototype=e,new t};const l=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",".","-",":","+","=","^","!","/","*","?","&","<",">","(",")","[","]","{","}","@","%","$","#"],u=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];return{CometD:function(O,i){const r=new ke,c=this,M=O||"default";let o=!1;const a=new Se;let l,n="disconnected",D=0,u=null,h=0,t=[],d=!1,N=0,g={};const s={};let f=0,p=null;const m=[];let b={},P,j;const v={},H={};let W=!1,y=!1,T=0,x=0,w=null,k=(i&&"undefined"!==i.glob&&(we=i.glob),{useWorkerScheduler:!0,protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",maxNetworkDelay:1e4,rearmNetworkDelayAfterMessage:!1,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2e3,maxSendBayeuxMessageSize:8192,advice:{timeout:6e4,interval:0,reconnect:void 0,maxInterval:0}});function X(e,t){try{return e[t]}catch(e){}}function _(e){return _e.isString(e)}function J(t){if(_(t)&&!(t.length<2)&&"/"===t.charAt(0)){for(let e=1;e<t.length;++e){var n=t.charAt(e);if(!("A"<=(i=n)&&i<="Z"||"a"<=i&&i<="z"||"0"<=(i=n)&&i<="9"||function(e){switch(e){case" ":case"!":case"#":case"$":case"(":case")":case"*":case"+":case"-":case".":case"/":case"@":case"_":case"{":case"~":case"}":return 1;default:return}}(n)))return}var i;return 1}}function S(e){return null!=e&&"function"==typeof e}function C(e,t){let n="";for(;0<--t&&!(e>=Math.pow(10,t));)n+="0";return n+=e}function e(e,t){var n;"file"===e?i&&i.errorLogger&&i.errorLogger.apply(null,t):we.console&&S(e=we.console[e])&&(n=new Date,[].splice.call(t,0,0,C(n.getHours(),2)+":"+C(n.getMinutes(),2)+":"+C(n.getSeconds(),2)+"."+C(n.getMilliseconds(),3)),e.apply(we.console,t))}function z(e){return new RegExp("(^https?://)?(((\\[[^\\]]+])|([^:/?#]+))(:(\\d+))?)?([^?#]*)(.*)?").exec(e)}function Z(t){c._debug("Configuring cometd object with",t),t=(t=_(t)?{url:t}:t)||{},k=c._mixin(!1,k,t);t=c.getURL();if(!t)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var t=z(t),n=t[2],i=t[8],t=t[9];if(o=c._isCrossDomain(n),k.appendMessageTypeToURL)if(void 0!==t&&0<t.length)c._info("Appending message type to URI "+i+t+" is not supported, disabling 'appendMessageTypeToURL' configuration"),k.appendMessageTypeToURL=!1;else{n=i.split("/");let e=n.length-1;i.match(/\/$/)&&--e,0<=n[e].indexOf(".")&&(c._info("Appending message type to URI "+i+" is not supported, disabling 'appendMessageTypeToURL' configuration"),k.appendMessageTypeToURL=!1)}if(window.Worker&&window.Blob&&window.URL&&k.useWorkerScheduler){let e=function(){const i={};self.onmessage=e=>{const t=e.data;var n=i[t.id];switch(t.type){case"setTimeout":i[t.id]=self.setTimeout(()=>{delete i[t.id],self.postMessage({id:t.id})},t.delay);break;case"clearTimeout":delete i[t.id],n&&self.clearTimeout(n);break;default:throw"Unknown command "+t.type}}}.toString();e=e.substring(e.indexOf("{")+1,e.lastIndexOf("}"));t=new window.Blob([e],{type:"application/json"}),n=window.URL.createObjectURL(t);const s=new window.Worker(n);r.setTimeout=(e,t)=>{e=r.register(e);return s.postMessage({id:e,type:"setTimeout",delay:t}),e},r.clearTimeout=e=>{r.unregister(e),s.postMessage({id:e,type:"clearTimeout"})},s.onmessage=e=>{e=e.data.id,e=r.unregister(e);e&&e()}}}function V(e){var t;e&&(t=g[e.channel])&&t[e.id]&&(delete t[e.id],c._debug("Removed",e.listener?"listener":"subscription",e))}function $(e){e&&!e.listener&&V(e)}function G(){for(var e in g)if(g.hasOwnProperty(e)){var t=g[e];if(t)for(var n in t)t.hasOwnProperty(n)&&$(t[n])}}function R(e){n!==e&&(c._debug("Status",n,"->",e),n=e)}function E(){return"disconnecting"===n||"disconnected"===n}function I(){return""+ ++D}function K(e,t,n,i,s){try{return t.call(e,i)}catch(e){t=c.onExtensionException;if(S(t)){c._debug("Invoking extension exception handler",n,e);try{t.call(c,e,n,s,i)}catch(e){c._info("Exception during execution of extension exception handler",n,e)}}else c._info("Exception during execution of extension",n,e);return i}}function Q(e,t){var n=g[e];if(n)for(var i in n)if(n.hasOwnProperty(i)){i=n[i];if(i)try{i.callback.call(i.scope,t)}catch(e){var s=c.onListenerException;if(S(s)){c._debug("Invoking listener exception handler",i,e);try{s.call(c,e,i,i.listener,t)}catch(e){c._info("Exception during execution of listener exception handler",i,e)}}else c._info("Exception during execution of listener",i,t,e)}}}function L(e,t){Q(e,t);var n=e.split("/"),i=n.length-1;for(let e=i;0<e;--e){var s=n.slice(0,e).join("/")+"/*";e===i&&Q(s,t),Q(s+="*",t)}}function Y(){null!==p&&c.clearTimeout(p),p=null}function ee(e,t){Y();t=b.interval+t;c._debug("Function scheduled in",t,"ms, interval =",b.interval,"backoff =",f,e),p=c.setTimeout(e,t)}this._mixin=function(t,n,e){var i=n||{};for(let e=2;e<arguments.length;++e){var s,r,o=arguments[e];if(null!=o)for(var a in o)o.hasOwnProperty(a)&&(s=X(o,a),r=X(i,a),s!==n)&&void 0!==s&&(t&&"object"==typeof s&&null!==s?s instanceof Array?i[a]=this._mixin(t,r instanceof Array?r:[],s):(r="object"!=typeof r||r instanceof Array?{}:r,i[a]=this._mixin(t,r,s)):i[a]=s)}return i},this._warn=function(){e("warn",arguments)},this._info=function(){"warn"!==k.logLevel&&e("info",arguments)},this._debug=function(){"debug"===k.logLevel&&e("debug",arguments)},this._logError=function(){e("file",arguments)},this._isCrossDomain=e=>!!(we.location&&we.location.host&&e)&&e!==we.location.host;let te,ne;function U(n,t,i){for(let t=0;t<n.length;++t){let e=n[t];var s=e.id;u&&(e.clientId=u),void 0!==(e=function(t){for(let e=m.length-1;0<=e&&null!=t;--e){var n=m[e],i=n.extension.outgoing;S(i)&&(t=void 0===(i=K(n.extension,i,n.name,t,!0))?t:i)}return t}(e))&&null!==e?(e.id=s,n[t]=e):(delete v[s],n.splice(t--,1))}if(0!==n.length){t&&(w=n[0]);let e=c.getURL();k.appendMessageTypeToURL&&(e.match(/\/$/)||(e+="/"),i)&&(e+=i);i={url:e,sync:!1,messages:n,onSuccess:e=>{try{te.call(c,e)}catch(e){c._info("Exception during handling of messages",e)}},onFailure:(e,t,n)=>{try{var i=c.getTransport();n.connectionType=i?i.getType():"unknown",ne.call(c,e,t,n)}catch(e){c._info("Exception during handling of failure",e)}}};c._debug("Send",i),l.send(i,t)}}function A(e){0<h||!0===d?t.push(e):U([e],!1)}function q(){f=0}function ie(){var e=t;t=[],0<e.length&&U(e,!1)}function se(e){R("connecting"),ee(()=>{var e;E()||(e={id:I(),channel:"/meta/connect",connectionType:l.getType()},y||(e.advice={timeout:0}),R("connecting"),c._debug("Connect sent",e),U([e],!0,"connect"),R("connected"))},e)}function re(e){e&&(b=c._mixin(!1,{},k.advice,e),c._debug("New advice",b))}function B(e){Y(),e&&l&&l.abort(),o=!1,l=null,R("disconnected"),u=null,h=0,q(),W=!1,y=!1,T=0,w=null,0<t.length&&(e=t,t=[],ne.call(c,void 0,e,{reason:"Disconnected"}))}function oe(e,t,n){var i=c.onTransportException;if(S(i)){c._debug("Invoking transport exception handler",e,t,n);try{i.call(c,n,e,t)}catch(e){c._info("Exception during execution of transport exception handler",e)}}}function ae(e,t){S(e)&&(t=e,e=void 0),u=null,G(),E()&&a.reset(!0),re({}),h=0,d=!0,P=e,j=t;var e="1.0",n=c.getURL(),i=a.findTransportTypes(e,o,n),s={id:I(),version:e,minimumVersion:e,channel:"/meta/handshake",supportedConnectionTypes:i,advice:{timeout:b.timeout,interval:b.interval}},s=c._mixin(!1,{},P,s);if((c._putCallback(s.id,t),!l)&&!(l=a.negotiateTransport(i,e,o,n)))throw t="Could not find initial transport among: "+a.getTransportTypes(),c._warn(t),t;c._debug("Initial transport is",l.getType()),R("handshaking"),c._debug("Handshake sent",s),U([s],!1,"handshake")}function ce(t,n){try{t.call(c,n)}catch(e){t=c.onCallbackException;if(S(t)){c._debug("Invoking callback exception handler",e);try{t.call(c,e,n)}catch(e){c._info("Exception during execution of callback exception handler",e)}}else c._info("Exception during execution of message callback",e)}}function F(e){var t=c._getCallback([e.id]);S(t)&&(delete v[e.id],ce(t,e))}function le(e){var t=H[e.id];if(delete H[e.id],t){c._debug("Handling remote call response for",e,"with context",t);var n=t.timeout,n=(n&&c.clearTimeout(n),t.callback);if(S(n))return ce(n,e),1}}function ue(e){c._debug("Transport failure handling",e),e.transport&&(l=e.transport),e.url&&l.setURL(e.url);var t,n=e.action,i=e.delay||0;switch(n){case"handshake":t=i,R("handshaking"),d=!0,ee(()=>{ae(P,j)},t);break;case"retry":se(i);break;case"none":B(!0);break;default:throw"Unknown action "+n}}function he(e,t){F(e),L("/meta/handshake",e),L("/meta/unsuccessful",e),E()&&(t.action="none"),c.onTransportFailure.call(c,e,t,ue)}function de(e){return"disconnected"===n||w&&w.id===e.id&&(w=null,1)}function ge(e,t){L("/meta/connect",e),L("/meta/unsuccessful",e),E()&&(t.action="none"),c.onTransportFailure.call(c,e,t,ue)}function fe(e){B(!0),F(e),L("/meta/disconnect",e),L("/meta/unsuccessful",e)}function pe(e){var t,n=g[e.subscription];if(n)for(var i in n)n.hasOwnProperty(i)&&(t=n[i])&&!t.listener&&(delete n[i],c._debug("Removed failed subscription",t));F(e),L("/meta/subscribe",e),L("/meta/unsuccessful",e)}function me(e){F(e),L("/meta/unsubscribe",e),L("/meta/unsuccessful",e)}function be(e){le(e)||(F(e),L("/meta/publish",e),L("/meta/unsuccessful",e))}function ve(e){var t;if(T=0,null!=(e=function(t){for(let e=0;e<m.length&&null!=t;++e){var n=m[e],i=n.extension.incoming;S(i)&&(t=void 0===(i=K(n.extension,i,n.name,t,!1))?t:i)}return t}(e)))switch(re(e.advice),e.channel){case"/meta/handshake":var n=e,i=c.getURL();if(n.successful){var s=c._isCrossDomain(z(i)[2]),s=a.negotiateTransport(n.supportedConnectionTypes,n.version,s,i);if(null===s)n.successful=!1,he(n,{cause:"negotiation",action:"none",transport:null});else{l!==s&&(c._debug("Transport",l&&l.getType(),"->",s.getType()),l=s),u=n.clientId,d=!1,ie(),n.reestablish=W,W=!0,F(n),L("/meta/handshake",n),x=n["x-messages"]||0;var r=E()?"none":b.reconnect||"retry";switch(r){case"retry":q(),0===x?se(0):c._debug("Processing",x,"handshake-delivered messages");break;case"none":B(!0);break;default:throw"Unrecognized advice action "+r}}}else he(n,{cause:"unsuccessful",action:b.reconnect||"handshake",transport:l});break;case"/meta/connect":i=e;if(de(i))if(y=i.successful){L("/meta/connect",i);var o=E()?"none":b.reconnect||"retry";switch(o){case"retry":q(),se(f);break;case"none":B(!1);break;default:throw"Unrecognized advice action "+o}}else ge(i,{cause:"unsuccessful",action:b.reconnect||"retry",transport:l});else c._debug("Mismatched /meta/connect reply",i);break;case"/meta/disconnect":(s=e).successful?(B(!1),F(s),L("/meta/disconnect",s)):fe(s);break;case"/meta/subscribe":(n=e).successful?(F(n),L("/meta/subscribe",n)):pe(n);break;case"/meta/unsubscribe":(t=e).successful?(F(t),L("/meta/unsubscribe",t)):me(t);break;default:void 0!==(t=e).data?le(t)||(L(t.channel,t),0<x&&0===--x&&(c._debug("Processed last handshake-delivered message"),se(0))):void 0===t.successful?c._warn("Unknown Bayeux Message",t):t.successful?(F(t),L("/meta/publish",t)):be(t)}}function ye(e){var t=g[e];if(t)for(var n in t)if(t.hasOwnProperty(n)&&t[n])return 1}function Te(e,t){var n={scope:e,method:t};if(S(e))n.scope=void 0,n.method=e;else if(_(t)){if(!e)throw"Invalid scope "+e;if(n.method=e[t],!S(n.method))throw"Invalid callback "+t+" for scope "+e}else if(!S(t))throw"Invalid callback "+t;return n}function xe(e,t,n,i){t=Te(t,n),c._debug("Adding",i?"listener":"subscription","on",e,"with scope",t.scope,"and callback",t.method),n=++N,t={id:n,channel:e,scope:t.scope,callback:t.method,listener:i};let s=g[e];return s||(s={},g[e]=s),s[n]=t,c._debug("Added",i?"listener":"subscription",t),t}this.send=A,this._getCallback=e=>v[e],this._putCallback=function(e,t){var n=this._getCallback(e);return S(t)&&(v[e]=t),n},this.onTransportFailure=function(e,t,n){this._debug("Transport failure",t,"for",e);var i,s=this.getTransportRegistry(),r=this.getURL(),o=this._isCrossDomain(z(r)[2]),a=s.findTransportTypes("1.0",o,r);"none"===t.action?"/meta/handshake"!==e.channel||t.transport||(i="Could not negotiate transport, client=["+a+"], server=["+e.supportedConnectionTypes+"]",this._warn(i),l&&oe(l.getType(),null,{reason:i,connectionType:l.getType(),transport:l})):(t.delay=this.getBackoffPeriod(),"/meta/handshake"===e.channel?(t.transport||(i=l?l.getType():null,(o=s.negotiateTransport(a,"1.0",o,r))?(r=o.getType(),l&&(this._debug("Transport",i,"->",r),oe(i,r,e.failure)),t.action="handshake",t.transport=o):(this._warn("Could not negotiate transport, client=["+a+"]"),l&&oe(i,null,e.failure),t.action="none")),"none"!==t.action&&this.increaseBackoffPeriod()):(r=(new Date).getTime(),0===T&&(T=r),"retry"===t.action&&(t.delay=this.increaseBackoffPeriod(),0<(o=b.maxInterval))&&(a=b.timeout+b.interval+o,r-T+f>a)&&(t.action="handshake"),"handshake"===t.action&&(t.delay=0,s.reset(!1),this.resetBackoffPeriod()))),n.call(c,t)},this.receive=ve,te=t=>{c._debug("Received",t);for(let e=0;e<t.length;++e)ve(t[e])},ne=(e,t,n)=>{c._debug("handleFailure",e,t,n),n.transport=e;for(let e=0;e<t.length;++e){var i=t[e],s={id:i.id,successful:!1,channel:i.channel,failure:n};switch((n.message=i).channel){case"/meta/handshake":he(s,{cause:"failure",action:"handshake",transport:null});break;case"/meta/connect":de(r=s)?(y=!1,ge(r,{cause:"failure",action:"retry",transport:null})):c._debug("Mismatched /meta/connect failure",r);break;case"/meta/disconnect":fe(s);break;case"/meta/subscribe":s.subscription=i.subscription,pe(s);break;case"/meta/unsubscribe":s.subscription=i.subscription,me(s);break;default:be(s)}}var r},this.registerTransport=function(e,t,n){n=a.add(e,t,n);return n&&(this._debug("Registered transport",e),S(t.registered))&&t.registered(e,this),n},this.unregisterTransport=function(e){var t=a.remove(e);return null!==t&&(this._debug("Unregistered transport",e),S(t.unregistered))&&t.unregistered(),t},this.unregisterTransports=()=>{a.clear()},this.getTransportTypes=()=>a.getTransportTypes(),this.findTransport=e=>a.find(e),this.getTransportRegistry=()=>a,this.configure=function(e){Z.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=(e,t)=>{if("disconnected"!==n)throw"Illegal state: handshaken";ae(e,t)},this.disconnect=function(e,t){var n;E()?t&&t():(S(e)&&(t=e,e=void 0),n={id:I(),channel:"/meta/disconnect"},e=this._mixin(!1,{},e,n),c._putCallback(e.id,t),R("disconnecting"),U([e],!1,"disconnect"))},this.startBatch=()=>{++h,c._debug("Starting batch, depth",h)},this.endBatch=()=>{if(--h,c._debug("Ending batch, depth",h),h<0)throw"Calls to startBatch() and endBatch() are not paired";0!==h||E()||d||ie()},this.batch=function(e,t){e=Te(e,t);this.startBatch();try{e.method.call(e.scope),this.endBatch()}catch(e){throw this._info("Exception during execution of batch",e),this.endBatch(),e}},this.addTransportListener=(e,t)=>{if("timeout"!==e)throw"Unsupported event "+e;let n=s[e];n||(s[e]=n=[]),n.push(t)},this.removeTransportListener=(e,t)=>{e=s[e];if(e){t=e.indexOf(t);if(0<=t)return e.splice(t,1),!0}return!1},this._getTransportListeners=e=>s[e],this.addListener=function(e,t,n){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(_(e))return xe(e,t,n,!0);throw"Illegal argument type: channel must be a string"},this.removeListener=e=>{if(!(e&&e.channel&&"id"in e))throw"Invalid argument: expected subscription, not "+e;V(e)},this.clearListeners=()=>{g={}},this.subscribe=function(e,t,n,i,s){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!J(e))throw"Illegal argument: invalid channel "+e;if(E())throw"Illegal state: disconnected";S(t)&&(s=i,i=n,n=t,t=void 0),S(i)&&(s=i,i=void 0);var r=!ye(e),o=xe(e,t,n,!1);return r?(r={id:I(),channel:"/meta/subscribe",subscription:e},r=this._mixin(!1,{},i,r),c._putCallback(r.id,s),A(r)):S(s)&&c.setTimeout(()=>{ce(s,{id:I(),successful:!0,channel:"/meta/subscribe",subscription:e})},0),o},this.unsubscribe=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(E())throw"Illegal state: disconnected";S(t)&&(n=t,t=void 0),this.removeListener(e);const i=e.channel;var s;ye(i)?S(n)&&c.setTimeout(()=>{ce(n,{id:I(),successful:!0,channel:"/meta/unsubscribe",subscription:i})},0):(s={id:I(),channel:"/meta/unsubscribe",subscription:i},s=this._mixin(!1,{},t,s),c._putCallback(s.id,n),A(s))},this.resubscribe=function(e,t){if($(e),e)return this.subscribe(e.channel,e.scope,e.callback,t)},this.clearSubscriptions=()=>{G()},this.publish=function(e,t,n,i){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!J(e))throw"Illegal argument: invalid channel "+e;if(/^\/meta\//.test(e))throw"Illegal argument: cannot publish to meta channels";if(E())throw"Illegal state: disconnected";S(t)?(i=t,t={},n=void 0):S(n)&&(i=n,n=void 0);var s={id:I(),channel:e,data:t},s=this._mixin(!1,{},n,s);c._putCallback(s.id,i),A(s)},this.publishBinary=function(e,t,n,i,s,r){S(t)?(r=t,t=new ArrayBuffer(0),n=!0,s=i=void 0):S(n)?(r=n,n=!0,s=i=void 0):S(i)?(r=i,s=i=void 0):S(s)&&(r=s,s=void 0);i={meta:i,data:t,last:n},t=this._mixin(!1,s,{ext:{binary:{}}});this.publish(e,i,t,r)},this.remoteCall=function(e,t,n,i,s){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!_(e))throw"Illegal argument type: target must be a string";if(E())throw"Illegal state: disconnected";if(S(t)?(s=t,t={},n=k.maxNetworkDelay,i=void 0):S(n)?(s=n,n=k.maxNetworkDelay,i=void 0):S(i)&&(s=i,i=void 0),"number"!=typeof n)throw"Illegal argument type: timeout must be a number";var r="/service"+(e=e.match(/^\//)?e:"/"+e);if(!J(r))throw"Illegal argument: invalid target "+e;r={id:I(),channel:r,data:t};const o=this._mixin(!1,{},i,r);r={callback:s};0<n&&(r.timeout=c.setTimeout(()=>{c._debug("Timing out remote call",o,"after",n,"ms"),be({id:o.id,error:"406::timeout",successful:!1,failure:{message:o,reason:"Remote Call Timeout"}})},n),c._debug("Scheduled remote call timeout",o,"in",n,"ms")),H[o.id]=r,A(o)},this.remoteCallBinary=function(e,t,n,i,s,r,o){S(t)?(o=t,t=new ArrayBuffer(0),n=!0,i=void 0,s=k.maxNetworkDelay,r=void 0):S(n)?(o=n,n=!0,i=void 0,s=k.maxNetworkDelay,r=void 0):S(i)?(o=i,i=void 0,s=k.maxNetworkDelay,r=void 0):S(s)?(o=s,s=k.maxNetworkDelay,r=void 0):S(r)&&(o=r,r=void 0);i={meta:i,data:t,last:n},t=this._mixin(!1,r,{ext:{binary:{}}});this.remoteCall(e,i,s,t,o)},this.getStatus=()=>n,this.isDisconnected=E,this.setBackoffIncrement=e=>{k.backoffIncrement=e},this.getBackoffIncrement=()=>k.backoffIncrement,this.getBackoffPeriod=()=>f,this.increaseBackoffPeriod=()=>(f<k.maxBackoff&&(f+=k.backoffIncrement),f),this.resetBackoffPeriod=()=>{q()},this.setLogLevel=e=>{k.logLevel=e},this.registerExtension=function(t,e){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!_(t))throw"Illegal argument type: extension name must be a string";let n=!1;for(let e=0;e<m.length;++e)if(m[e].name===t){n=!0;break}return n?(this._info("Could not register extension with name",t,"since another extension with the same name already exists"),!1):(m.push({name:t,extension:e}),this._debug("Registered extension",t),S(e.registered)&&e.registered(t,this),!0)},this.unregisterExtension=function(t){if(!_(t))throw"Illegal argument type: extension name must be a string";let n=!1;for(let e=0;e<m.length;++e){var i=m[e];if(i.name===t){m.splice(e,1),n=!0,this._debug("Unregistered extension",t);i=i.extension;S(i.unregistered)&&i.unregistered();break}}return n},this.getExtension=t=>{for(let e=0;e<m.length;++e){var n=m[e];if(n.name===t)return n.extension}return null},this.getName=()=>M,this.getClientId=()=>u,this.getURL=()=>{if(l){var e=l.getURL();if(e)return e;if(e=k.urls[l.getType()])return e}return k.url},this.getTransport=()=>l,this.getConfiguration=function(){return this._mixin(!0,{},k)},this.getAdvice=function(){return this._mixin(!0,{},b)},this.setTimeout=(t,e)=>r.setTimeout(()=>{try{c._debug("Invoking timed function",t),t()}catch(e){c._debug("Exception invoking timed function",t,e)}},e),this.clearTimeout=e=>{r.clearTimeout(e)},i&&i.noDefaultTransports||(we.WebSocket&&this.registerTransport("websocket",new Ee),this.registerTransport("long-polling",new Ce),this.registerTransport("callback-polling",new Re))},Transport:y,RequestTransport:n,LongPollingTransport:Ce,CallbackPollingTransport:Re,WebSocketTransport:Ee,Utils:_e,Z85:{encode:e=>{let t=null;if(e instanceof ArrayBuffer?t=e:e.buffer instanceof ArrayBuffer?t=e.buffer:Array.isArray(e)&&(t=new Uint8Array(e).buffer),null==t)throw"Cannot Z85 encode "+e;var n=t.byteLength,e=n%4,i=4-(0==e?4:e),s=new DataView(t);let r="",o=0;for(let e=0;e<n+i;++e){var a,c=e>=n;if(o=256*o+(c?0:s.getUint8(e)),(e+1)%4==0){let t=52200625;for(let e=5;0<e;--e)(!c||e>i)&&(a=Math.floor(o/t)%85,r+=l[a]),t/=85;o=0}}return r},decode:t=>{var e=t.length%5,n=5-(0==e?5:e);for(let e=0;e<n;++e)t+=l[l.length-1];var i=t.length,e=new ArrayBuffer(4*i/5-n),s=new DataView(e);let r=0,o=0,a=0;for(let e=0;e<i;++e){var c=t.charCodeAt(o++)-32;if(r=85*r+u[c],o%5==0){let e=16777216;for(;1<=e;)a<s.byteLength&&s.setUint8(a++,Math.floor(r/e)%256),e/=256;r=0}}return e}}}},(e=this).org=e.org||{},e.org.cometd=t(),(e=>e.AckExtension=function(){let n,r=!1,o;function a(e,t){n._debug(e,t)}this.registered=(e,t)=>{n=t,a("AckExtension: executing registration callback")},this.unregistered=()=>{a("AckExtension: executing unregistration callback"),n=null},this.incoming=e=>{var t,n,i=e.channel,s=e.ext;return"/meta/handshake"===i?(s&&("object"==typeof(t=s.ack)?(r=!0===t.enabled,"number"==typeof(n=t.batch)&&(o=n)):r=!0===t),a("AckExtension: server supports acknowledgements",r)):"/meta/connect"===i&&e.successful&&r&&s&&"number"==typeof s.ack&&a("AckExtension: server sent batch",o=s.ack),e},this.outgoing=e=>{var t=e.channel;return e.ext||(e.ext={}),"/meta/handshake"===t?(e.ext.ack=n&&!1!==n.ackEnabled,r=!1,o=0):"/meta/connect"===t&&r&&a("AckExtension: client sending batch",e.ext.ack=o),e}})(this.org.cometd),(e=>e.TimeSyncExtension=function(e){let i;const o=e&&e.maxSamples||10;let a=[],c=[],l=0,u=0;function h(e,t){i._debug(e,t)}this.registered=(e,t)=>{i=t,h("TimeSyncExtension: executing registration callback")},this.unregistered=()=>{h("TimeSyncExtension: executing unregistration callback"),i=null,a=[],c=[]},this.incoming=e=>{var i=e.channel;if(i&&0===i.indexOf("/meta/")&&e.ext&&e.ext.timesync){var i=e.ext.timesync,s=(h("TimeSyncExtension: server sent timesync",i),(new Date).getTime()),s=(s-i.tc-i.p)/2,i=i.ts-i.tc-s,r=(a.push(s),c.push(i),c.length>o&&(c.shift(),a.shift()),c.length);let t=0,n=0;for(let e=0;e<r;++e)t+=a[e],n+=c[e];l=parseInt((t/r).toFixed()),u=parseInt((n/r).toFixed()),h("TimeSyncExtension: network lag",l,u,l,u)}return e},this.outgoing=e=>{var t=e.channel;return t&&0===t.indexOf("/meta/")&&(e.ext||(e.ext={}),e.ext.timesync={tc:(new Date).getTime(),l:l,o:u},h("TimeSyncExtension: client sending timesync",e.ext.timesync)),e},this.getTimeOffset=()=>u,this.getTimeOffsetSamples=()=>c,this.getNetworkLag=()=>l,this.getServerTime=()=>(new Date).getTime()+u,this.getServerDate=function(){return new Date(this.getServerTime())},this.setTimeout=(e,t)=>{let n=(t instanceof Date?t.getTime():0+t)-u-(new Date).getTime();return n<=0&&(n=1),i.setTimeout(e,n)}})(this.org.cometd),(n=>n.BinaryExtension=function(){this.incoming=e=>{var t;return/^\/meta\//.test(e.channel)||(t=e.ext)&&t.binary&&(e.data.data=n.Z85.decode(e.data.data)),e},this.outgoing=e=>{var t;return/^\/meta\//.test(e.channel)||(t=e.ext)&&t.binary&&(e.data.data=n.Z85.encode(e.data.data)),e}})(this.org.cometd),org.cometd});